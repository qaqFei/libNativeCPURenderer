<!DOCTYPE html>

<body>
    <h1>å“ˆåŸºç±³å‘ç”Ÿå™¨</h1>
    <p>ä¸Šä¼ ä½ çš„ midi æ–‡ä»¶, ç‚¹å‡»å‘ç”Ÿ</p>

    midi: <input type="file" id="midi-input"><br>
    min note: <input type="number" id="min-note" value="60"><br>
    max note: <input type="number" id="max-note" value="128"><br>
    note offset: <input type="number" id="note-offset" value="0"><br>
    offset: <input type="number" id="offset" value="0"><br>
    <button id="ğŸ±">å‘ç”Ÿ</button>
</body>

<script>
    window.$ = x => document.querySelector(x);
    window.$$ = x => document.querySelectorAll(x);

    $("#ğŸ±").addEventListener("click", e => {
        const files = $("#midi-input").files;
        if (files.length === 0) {
            alert("è¯·é€‰æ‹©ä¸€ä¸ª midi æ–‡ä»¶");
            return;
        }

        const file = files[0];
        const reader = new FileReader();
        $("#ğŸ±").disabled = true;
        $("#ğŸ±").innerText = "å“ˆï¼ï¼ï¼";
        reader.onload = e => {
            const data = e.target.result;
            fetch(`/ğŸ±/${$("#min-note").value}/${$("#max-note").value}/${$("#note-offset").value}/${$("#offset").value}`, {
                method: "POST",
                body: data
            }).then(res => res.blob()).then(res => {
                const url = URL.createObjectURL(res);
                const a = document.createElement("a");
                a.href = url;
                a.download = `${file.name.replaceAll(".mid", "").replaceAll(".midi", "")}_ğŸ±.mp3`;
                a.click();
                $("#ğŸ±").disabled = false;
                $("#ğŸ±").innerText = "å‘ç”Ÿ";
            });
        };
        reader.readAsArrayBuffer(file);
    });
</script>
